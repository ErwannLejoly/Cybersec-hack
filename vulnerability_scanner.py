# cybersec-hack/vulnerability_scanner.py

import subprocess

def run_nikto_scan(target):
    print("[+] Détection de serveur web sur la cible avec Nikto...")
    try:
        result = subprocess.check_output([
            "nikto", "-h", target
        ], stderr=subprocess.DEVNULL).decode()
        with open("nikto_output.txt", "w") as f:
            f.write(result)
        print("[✓] Scan Nikto terminé. Résultats enregistrés dans nikto_output.txt")
        return result
    except subprocess.CalledProcessError:
        print("[!] Erreur ou absence de serveur web détecté. Nikto ignoré.")
        return "Aucun serveur web détecté ou Nikto a échoué."

def run_web_bruteforce(target):
    print("[+] Test de bruteforce HTTP (si applicable)...")
    try:
        import requests
        resp = requests.get(f"http://{target}", timeout=5)
        if resp.status_code == 200:
            print("[✓] Serveur HTTP détecté. Lancement de bruteforce...")
            subprocess.run([
                "hydra",
                "-L", "wordlists/users.txt",
                "-P", "wordlists/rockyou.txt",
                f"{target}", "http-get"
            ])
        else:
            print("[~] Serveur web non accessible (code non 200). Bruteforce ignoré.")
    except Exception as e:
        print(f"[~] Pas de serveur HTTP détecté ou erreur : {e}. Bruteforce ignoré.")
